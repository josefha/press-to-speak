# Cursor Next-Step Context: Supabase Bootstrap

Date: 2026-02-21
Repo: /Users/josef/Desktop/projects/private-projects/press-to-speak-mono/press-to-speak

## Current State

- Supabase cloud project exists.
- Local repo currently has no `supabase/` directory and no migration files.
- Mac app auth flow is implemented for:
  - `PressToSpeak Account` (default, Supabase auth)
  - `Bring Your Own Keys` (advanced)
- API auth/routing is implemented with secure defaults:
  - `USER_AUTH_MODE=required` by default
  - `ALLOW_UNAUTHENTICATED_BYOK=false` by default

## Security / Process Rules

- Migration SQL must be generated by Supabase tooling (CLI/MCP), not handwritten by LLM.
- Keep secret/service-role keys server-side only.
- Prefer `SUPABASE_PUBLISHABLE_KEY` in client-facing app config.

## Next Step (Do This First)

1. Initialize Supabase in this repo root.
2. Link this local repo to your Supabase project.
3. Only pull remote schema if you already changed schema remotely.

Commands:

```bash
cd /Users/josef/Desktop/projects/private-projects/press-to-speak-mono/press-to-speak
npx supabase login
npx supabase init
npx supabase link --project-ref <your-project-ref>
# If remote schema is untouched, skip db pull.
# If you already changed schema in dashboard/studio, run:
# npx supabase db pull --linked
```

## First Migration Workflow (After You Actually Change Schema)

1. Apply intended schema/policy changes in dev (Cursor MCP SQL tools or Supabase Studio).
2. Generate migration diff:

```bash
npx supabase db diff -f <descriptive_migration_name> --linked
```

3. Validate migration replay locally:

```bash
npx supabase start
npx supabase db reset
```

4. Commit only generated files under `supabase/migrations/`.

## Cursor Prompt (Copy/Paste)

```text
Use /Users/josef/Desktop/projects/private-projects/press-to-speak-mono/press-to-speak as cwd.
Current state: Supabase cloud project exists, but this repo has no supabase/ directory and no migrations yet.
Task:
1) Bootstrap local Supabase CLI config (init + link to project ref).
2) Do not handwrite migration SQL.
3) If remote DB has no prior schema changes, do not create a migration yet.
4) If remote schema has changes, use generated migration flow (`supabase db pull` or `supabase db diff -f ... --linked`) and summarize exactly what was generated.
Return the exact commands executed and any new files created.
```
